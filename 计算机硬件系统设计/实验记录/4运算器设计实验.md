[TOC]

# 运算器设计实验

## 8位可控加减法电路设计

这个比较简单，将8个全加器串联即可，如下所示：

![](./img/4.1.png)

需要注意的三点：

1. 因为要同时实现减法，这里对$Y$进行了一级异或门处理，即当Sub信号有效时，$Y$的所有位取反，同时在最低位的全加器的进位输入1。这种处理等价于求$-Y$。

2. 因为是单符号位补码的溢出判断，因此采用最高位进位位和次高位进位位的异或作为OF信号输出。

3. 考虑一个基本逻辑门的时延为1T，则异或门的时延为3T，则一个全加器的和的时延为6T，进位输出时延为5T，如下图所示：

   ![](./img/4.2.png)

   同时考虑全加器内部的依赖性，在没有收到进位输入时，第一个异或门也能得到一级结果。因此，每加一位，即每加一个全加器，进位输出延迟加$2T$，结果输出延迟加$3T$，故对于$n$位的串行加法器而言（不考虑减法器）有：

   1. 结果输出时延：$(2n+4)T$
   2. 进位输出时延：$(2n+3)T$
   3. 溢出标志时延：$(2n+6)T$

## CLA182四位先行进位电路设计

### 并行加法进位链

![](./img/4.4.png)

![](./img/4.5.png)![](./img/4.6.png)

### 成组进位

![](./img/4.7.png)

根据上述进位链可得电路：

![](./img/4.3.png)

需要注意的两点：

1. CLA182的输出时延都是2T。
2. P\*和G\*都是不依赖Cin输入。

## 4位快速加法器设计

首先，根据上一节中提及的生成和传递函数公式，设计传递生成模块：

![](./img/4.8.png)

易知，该模块的时延为3T。

接着组合CLA182和传递生成模块即可，如下：

![](./img/4.9.png)

高位和次高位进位输出以及成组进位的时延均为5T，加法结果的输出时延为8T。

## 16位快速加法器设计

其实就是并联上述4位快速加法器，重点在分析时延。

![](./img/4.10.png)

每一个快速加法器的成组进位输出会在$5T$时延后得到，然后相应的进位输入在经过CLA的$2T$时延之后得到，因此加法结果在经过4位快速加法器中的CLA和异或门之后给出，时延为$5T+2T+5T=12T$，而次高位的进位在$7T + 2T=9T$后给出。又因为上级CLA的进位输出和最高位输出等效，因此最高位的输出时延为$7T$，相比于下方的次高位时延要短。

## 32位快速加法器设计

两个16位快速加法器串联即可，电路如下：

![](./img/4.11.png)

注意级间进位要采用CLA的进位，这样时延更短。如上图，右侧结果时延和16位快速加法器一致，右侧向左侧的进位位时延为7T，因此左侧结果时延为$7T+2T+5T = 14T$，最高位进位时延为$9T$，次高位进位时延为$11T$。

## 5位无符号阵列乘法器设计

模拟手工乘法即可，原理如下：

![](./img/4.13.png)

电路如下：

![](./img/4.12.png)

上图采用斜向进位，关键路径如下所示：

![](./img/4.14.png)

总共需要8个全加器延迟和右下角的与门阵列延迟，故有总延迟$8*6T+1T=49T$。

与横向进位对比：

![](./img/4.15.png)

关键路径如下：

![](./img/4.16.png)

总共需要11个全加器延迟和与门阵列延迟，故总时延为$11*6T+1T=67T$。

## 6位有符号补码阵列乘法器

补码乘法分两部分：符号单独算，绝对值进行无符号乘法，如下：

![](./img/4.17.png)

注意上图中$-32\times 1 = -1024$的原因：

1. 因为补码的不对称性，无法用5位标识$X$的绝对值，绝对值部分的计算结果为0。
2. 因为符号和绝对值部分分开处理，因此结果的符号为负。

## 乘法流水线设计

因为乘法的时延很长，同时考虑到乘法相当于是分步的加法，因此采用流水线技术进行优化，原理如下：

![](./img/4.19.png)

![](./img/4.20.png)

对应电路如下：

![](./img/4.18.png)

## 原码一位乘法器设计

原码一位乘的原理：

![](./img/4.21.png)

![](./img/4.22.png)

需要注意的点：

1. n次加法，n次移位
2. 逻辑右移
3. 符号位单独运算

实现电路：

![](./img/4.23.png)

实现需要注意的地方：

1. Logisim平台不支持原码，因此这里没有做符号位的处理，仅为无符号数。
2. 因为不能直接将$Y$值输入寄存器中，因此这里需要$1+8=9$个周期才能完成运算，第一个周期用来装载$Y$。（注意右侧的计数器和常数9与0）
3. 乘积共16位，低位在$Y$寄存器处，高位在$\sum$寄存器处。
4. 注意为同步时序电路。

## 补码一位乘法器设计

![](./img/4.25.png)

注意：

1. n+1次加法，n次移位
2. 算术移位
3. 符号位参与运算

实现电路：

![](./img/4.24.png)

实现需要注意的点：

1. 算术移位的实现。
2. 同上2，周期总共为9，需要一个周期来进行装载。
3. 注意$Y_{n+1}$的更新，它是移出位。

## MIPS运算器设计

注意输出的隔离，其余没有太大的难度。

![](./img/4.26.png)